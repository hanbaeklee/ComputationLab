\subsection*{Recursive formulation}
The heterogeneous household's problem is as follows:
\begin{align*}
  V(a,z;S) &= \max_{c,l,a'}\text{ } log(c) - \frac{\eta}{1+\frac{1}{\chi}}l^{1+\frac{1}{\chi}}+ \beta \mathbb{E}V(a',z';S')
  \\
  \text{s.t.}\quad& c + a' = (1+r(S))a + w(S)zl - T
  \\
  & a'-(1-\delta)a\geq \phi I^{ss}
  \\
  & S' = \Gamma_{S}(S) \quad(\text{Aggregate law of motion})
  \\
  & z' \sim \pi(z'|z)
\end{align*}
where $S = \{\Phi,A,G\}$ is the aggregate state.

The production side is as follows:
\begin{align*}
  \max_{K,L} A K^{\alpha}L^{1-\alpha} - w(S)L - (r(S)+\delta)K
\end{align*}

The capital rent $r(S)$ and the wage $w(S)$ are determined at the competitive market:
\begin{align*}
  [r]&:\quad \int a'(a,z;S)d\Phi(S) = K'(S)
  \\
  [w]&:\quad \int z l(a,z;S) d\Phi(S) = L(S)
\end{align*}
